<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO -->
    <meta name="description" content="–û–ø—Ü–∏–æ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ Gold (CME) —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º —Ñ–æ—Ä–≤–∞—Ä–¥–∞. PCR, Volume, OI. –°–∫–∞—á–∞—Ç—å APK.">
    <meta name="keywords" content="Gold CME, Forward Calculator, PCR, –æ–ø—Ü–∏–æ–Ω—ã, –∑–æ–ª–æ—Ç–æ, 0DTE">
    
    <!-- –ò–ö–û–ù–ö–ê -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">

    <title>Gold Options - Forward Calculator</title>
    
    <style>
        /* --- –û–°–ù–û–í–ù–û–ô –î–ò–ó–ê–ô–ù (–¢–ï–ú–ù–´–ô) --- */
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent-gold: #FFD700;
            --call-color: #2e7d32;
            --put-color: #c62828;
            --strike-bg: #2c2c2c;
            --input-bg: #333;
        }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; }
        a { text-decoration: none; color: inherit; }
        
        /* –®–ê–ü–ö–ê */
        header { background: #333; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .logo { font-size: 1.5em; font-weight: bold; color: #fff; display: flex; align-items: center; gap: 10px; }
        .menu { list-style: none; display: flex; gap: 20px; padding: 0; margin: 0; }
        .menu a:hover { color: var(--accent-gold); }

        /* HERO */
        .hero { background: linear-gradient(135deg, #1f4037 0%, #99f2c8 100%); padding: 40px 20px; text-align: center; color: #121212; }
        .hero h1 { margin: 0 0 5px 0; font-size: 2em; color: #000; font-weight: 800; }
        .subtitle { font-size: 1.1em; margin-bottom: 20px; color: #333; font-weight: 600; }
        .btn-primary { background: #121212; color: #fff; padding: 12px 30px; border-radius: 25px; font-weight: bold; transition: 0.3s; }
        .btn-primary:hover { background: #333; }

        /* LIVE DATA SECTION */
        .live-data { padding: 20px; background: #000; }
        
        /* –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï */
        .warning-block {
            text-align: center; margin-bottom: 20px; border: 1px solid #444; background: #111; padding: 10px; border-radius: 8px;
        }
        .warning-title { color: #FFD700; font-size: 0.9em; font-weight: bold; text-transform: uppercase; }
        .warning-text { color: #ccc; font-size: 0.8em; margin: 0; }
        
        /* –ö–ê–†–¢–û–ß–ö–ò –î–ê–ù–ù–´–• */
        .data-container { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .data-card { background: #222; padding: 10px; border-radius: 8px; min-width: 120px; text-align: center; border: 1px solid #333; }
        .big-number { font-size: 1.3em; font-weight: bold; color: var(--accent-gold); margin: 5px 0; }
        .small-text { color: #888; font-size: 0.75em; }

        /* üî• –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –§–û–†–í–ê–†–î–ê (–ù–û–í–´–ô –ë–õ–û–ö) üî• */
        .calculator-panel {
            max-width: 600px;
            margin: 0 auto 15px auto;
            background: #2a2a2a;
            border: 1px solid var(--accent-gold);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.1);
        }
        .calc-label { font-weight: bold; color: #fff; }
        .calc-input {
            background: #111;
            border: 1px solid #555;
            color: var(--accent-gold);
            padding: 10px;
            border-radius: 5px;
            width: 100px;
            font-size: 1.2em;
            text-align: center;
            font-weight: bold;
        }
        .calc-input:focus { outline: none; border-color: var(--accent-gold); }

        /* –¢–ê–ë–õ–ò–¶–ê */
        .levels-container { 
            max-width: 1000px; margin: 0 auto; background: #1a1a1a; border-radius: 8px; overflow: hidden; border: 1px solid #333;
        }
        .table-header-info {
            background: #2c2c2c; padding: 8px; text-align: center; font-weight: bold; color: #fff; font-size: 0.9em; border-bottom: 1px solid #444;
            display: flex; justify-content: space-between; padding: 8px 20px;
        }
        .dte-tag { background: #d32f2f; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; }
        .pcr-tag { color: #4fc3f7; }

        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: center; font-size: 0.85em; }
        thead { background: #111; color: #aaa; font-size: 0.9em; }
        th { padding: 8px 4px; font-weight: 600; white-space: nowrap; }
        td { padding: 4px 2px; border-bottom: 1px solid #2a2a2a; } 
        
        .col-call { color: var(--call-color); }
        .col-put { color: var(--put-color); }
        .col-strike { background: #252525; color: #fff; font-weight: bold; font-size: 1.1em; border-left: 1px solid #333; border-right: 1px solid #333; width: 80px; transition: color 0.3s;}
        
        .row-atm td { background: rgba(255, 215, 0, 0.1); border-top: 1px solid var(--accent-gold); border-bottom: 1px solid var(--accent-gold); }
        .vol-high { font-weight: bold; color: #fff; background: rgba(255,255,255,0.05); }

        /* –ê–¥–∞–ø—Ç–∏–≤ —Ñ–æ—Ä–≤–∞—Ä–¥–∞ */
        .forward-active { color: var(--accent-gold) !important; text-decoration: underline; }

        /* –§–£–¢–ï–† –ò –ü–†–û–ß–ï–ï */
        .features, .download { padding: 40px 20px; text-align: center; }
        .download-card { background: #222; padding: 30px; display:inline-block; border-radius:10px; border:1px solid #333; }
        .btn-download { background: var(--call-color); color: white; padding: 15px 30px; border-radius: 5px; display: inline-block; margin: 10px 0; font-weight: bold; }
        footer { background: #111; padding: 20px; text-align: center; color: #666; font-size: 0.8em; }

        @media (max-width: 600px) {
            .menu { display: none; }
            .calc-label { font-size: 0.9em; }
            .calculator-panel { flex-direction: column; gap: 5px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo"><span>üìä</span> Gold Options</div>
        <ul class="menu">
            <li><a href="#features">–ò–Ω—Ñ–æ</a></li>
            <li><a href="#download">APK</a></li>
        </ul>
    </header>

    <section class="hero">
        <h1>Gold Options & Forward</h1>
        <p class="subtitle">–ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ + –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏</p>
        <a href="#download" class="btn-primary">–°–∫–∞—á–∞—Ç—å Android APK</a>
    </section>

    <!-- –°–ï–ö–¶–ò–Ø –î–ê–ù–ù–´–• -->
    <section class="live-data">
        
        <div class="warning-block">
            <div class="warning-title">‚ö† –°–¢–ê–¢–£–° –î–ê–ù–ù–´–•</div>
            <p class="warning-text">–¢–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑ –≤ 5 –º–∏–Ω. –¶–µ–Ω–∞ ‚Äî —Ä–∞–∑ –≤ 5 —Å–µ–∫.</p>
        </div>
        
        <div class="data-container">
            <div class="data-card">
                <div class="small-text">–¶–µ–Ω–∞ Futures</div>
                <div class="big-number" id="futures-price">...</div>
            </div>
            <div class="data-card">
                <div class="small-text">–ë–∞–ª–∞–Ω—Å</div>
                <div class="big-number" id="balance-price">...</div>
            </div>
            <div class="data-card">
                <div class="small-text">Put/Call Ratio</div>
                <div class="big-number" id="pcr-value">...</div> <!-- –ù–û–í–û–ï -->
            </div>
            <div class="data-card">
                <div class="small-text">–û–±–Ω–æ–≤–ª–µ–Ω–æ UTC</div>
                <div class="big-number" id="updated-time">--:--</div>
            </div>
        </div>

        <!-- üî• –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –§–û–†–í–ê–†–î–ê üî• -->
        <div class="calculator-panel">
            <label class="calc-label">Forward Correction (–§–æ—Ä–≤–∞—Ä–¥):</label>
            <input type="number" id="forward-input" class="calc-input" placeholder="0" step="0.5" value="0">
            <span style="font-size: 0.8em; color: #888;">(–î–æ–±–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∫ —Å—Ç—Ä–∞–π–∫–∞–º)</span>
        </div>
        
        <div class="levels-container">
            <div class="table-header-info">
                <span>INTRADAY <span class="dte-tag">0DTE</span></span>
                <span class="pcr-tag">PCR Sentiment: <span id="pcr-sentiment">Neutral</span></span>
            </div>
            
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="3" style="border-bottom: 2px solid var(--call-color);">CALLS</th>
                            <th style="background:#222;"></th>
                            <th colspan="3" style="border-bottom: 2px solid var(--put-color);">PUTS</th>
                        </tr>
                        <tr>
                            <th>OI</th><th>Vol</th><th>Prem</th>
                            <th style="background:#333; color:#fff;">STRIKE</th>
                            <th>Prem</th><th>Vol</th><th>OI</th>
                        </tr>
                    </thead>
                    <tbody id="option-body">
                        <tr><td colspan="7" style="padding: 20px;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="download" class="download">
        <h2>–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h2>
        <div class="download-card">
            <h3>Android APK</h3>
            <p style="color:#888;">–í–µ—Ä—Å–∏—è 1.0</p>
            <a href="downloads/gold-options.apk" download class="btn-download">üì• –°–∫–∞—á–∞—Ç—å APK</a>
        </div>
    </section>

    <footer>
        <p>&copy; 2025 Gold Options. Trade responsibly.</p>
    </footer>

    <!-- JS LOGIC -->
    <script>
        const DB_ROOT = "https://cmeparser-default-rtdb.europe-west1.firebasedatabase.app";
        
        let currentFuturesPrice = 0;
        let cachedTableData = []; // –•—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ
        let forwardCorrection = 0; // –ó–Ω–∞—á–µ–Ω–∏–µ —Ñ–æ—Ä–≤–∞—Ä–¥–∞

        // --- 1. –°–õ–£–®–ê–¢–ï–õ–¨ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê ---
        document.getElementById('forward-input').addEventListener('input', function(e) {
            const val = parseFloat(e.target.value);
            forwardCorrection = isNaN(val) ? 0 : val;
            
            // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å, –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ
            if (cachedTableData.length > 0) {
                renderTable(cachedTableData);
            }
        });

        // --- 2. –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–• ---
        async function fetchFastPrice() {
            try {
                const res = await fetch(`${DB_ROOT}/gold_fast.json`);
                const data = await res.json();
                if (data && data.price) {
                    currentFuturesPrice = data.price;
                    document.getElementById('futures-price').innerText = '$' + data.price.toFixed(1);
                    // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ –µ—Å—Ç—å, –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É ATM –ø—Ä–∏ —Å–º–µ–Ω–µ —Ü–µ–Ω—ã
                    if (cachedTableData.length > 0) renderTable(cachedTableData);
                }
            } catch (e) { console.error(e); }
        }

        async function fetchHeavyData() {
            console.log("‚è≥ –ó–∞–ø—Ä–æ—Å —Ç–∞–±–ª–∏—Ü—ã...");
            try {
                const res = await fetch(`${DB_ROOT}/gold_heavy.json`);
                const data = await res.json();
                
                if (!data) return;

                document.getElementById('balance-price').innerText = '$' + data.balance_price;
                document.getElementById('updated-time').innerText = data.updated_at_utc;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
                cachedTableData = data.data || [];
                
                // –°—á–∏—Ç–∞–µ–º PCR (Put Call Ratio)
                calculatePCR(cachedTableData);

                // –†–∏—Å—É–µ–º
                renderTable(cachedTableData);

            } catch (e) { console.error("–û—à–∏–±–∫–∞ —Ç–∞–±–ª–∏—Ü—ã:", e); }
        }

        // --- 3. –ü–û–î–°–ß–ï–¢ PCR (–ù–û–í–ê–Ø –§–ò–®–ö–ê) ---
        function calculatePCR(rows) {
            let totalPutOI = 0;
            let totalCallOI = 0;
            rows.forEach(r => {
                if(r.put) totalPutOI += r.put.oi;
                if(r.call) totalCallOI += r.call.oi;
            });
            
            if(totalCallOI === 0) return;
            const pcr = (totalPutOI / totalCallOI).toFixed(2);
            
            document.getElementById('pcr-value').innerText = pcr;
            
            const sentimentEl = document.getElementById('pcr-sentiment');
            if(pcr > 1.0) { sentimentEl.innerText = "Bearish (Put Heavy)"; sentimentEl.style.color = "#f44336"; }
            else if(pcr < 0.7) { sentimentEl.innerText = "Bullish (Call Heavy)"; sentimentEl.style.color = "#4caf50"; }
            else { sentimentEl.innerText = "Neutral"; sentimentEl.style.color = "#ccc"; }
        }

        // --- 4. –û–¢–†–ò–°–û–í–ö–ê –¢–ê–ë–õ–ò–¶–´ –° –£–ß–ï–¢–û–ú –§–û–†–í–ê–†–î–ê ---
        function renderTable(rows) {
            const tbody = document.getElementById('option-body');
            tbody.innerHTML = '';
            
            if (!rows || rows.length === 0) return;

            let closestRow = null;
            let minDiff = Infinity;

            rows.forEach(row => {
                const tr = document.createElement('tr');
                
                // üî• –ì–õ–ê–í–ù–ê–Ø –ú–ê–ì–ò–Ø: –°–¢–†–ê–ô–ö + –§–û–†–í–ê–†–î
                const originalStrike = parseFloat(row.strike);
                const displayStrike = originalStrike + forwardCorrection;

                // –ò—â–µ–º ATM –ø–æ –ù–û–í–û–ú–£ —Å—Ç—Ä–∞–π–∫—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—ã
                const diff = Math.abs(displayStrike - currentFuturesPrice);
                if (diff < minDiff) {
                    minDiff = diff;
                    closestRow = tr;
                }

                const c_oi = row.call?.oi || 0;
                const c_vol = row.call?.vol || 0;
                const c_prem = row.call?.premium || 0;
                const p_oi = row.put?.oi || 0;
                const p_vol = row.put?.vol || 0;
                const p_prem = row.put?.premium || 0;

                const boldC = c_oi > 500 ? 'vol-high' : '';
                const boldP = p_oi > 500 ? 'vol-high' : '';
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–π–∫, –µ—Å–ª–∏ —Ñ–æ—Ä–≤–∞—Ä–¥ –∞–∫—Ç–∏–≤–µ–Ω
                const strikeClass = forwardCorrection !== 0 ? 'col-strike forward-active' : 'col-strike';

                tr.innerHTML = `
                    <td class="col-call ${boldC}">${c_oi}</td>
                    <td class="col-call">${c_vol}</td>
                    <td class="col-call">${c_prem}</td>
                    
                    <td class="${strikeClass}">
                        ${Number.isInteger(displayStrike) ? displayStrike : displayStrike.toFixed(1)}
                    </td>
                    
                    <td class="col-put">${p_prem}</td>
                    <td class="col-put">${p_vol}</td>
                    <td class="col-put ${boldP}">${p_oi}</td>
                `;
                tbody.appendChild(tr);
            });

            if (closestRow) {
                closestRow.classList.add('row-atm');
                // –°–∫—Ä–æ–ª–ª–∏–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ —Ñ–æ—Ä–≤–∞—Ä–¥–∞ (—á—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–æ –ø—Ä–∏ –≤–≤–æ–¥–µ)
                // –ù–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–æ–ª–ª–∏–º
                if(document.activeElement.id !== 'forward-input') {
                     setTimeout(() => closestRow.scrollIntoView({block: "center", behavior: "auto"}), 100);
                }
            }
        }

        // –ó–ê–ü–£–°–ö
        fetchFastPrice();
        fetchHeavyData();
        setInterval(fetchFastPrice, 2000);   
        setInterval(fetchHeavyData, 300000); 
    </script>
</body>
</html>
